generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model bill {
  id                         Int            @id @default(autoincrement())
  code                       String?        @db.VarChar(45)
  user_id                    Int?
  bill_date                  DateTime?      @db.Timestamp(0)
  total_price                Decimal?       @default(0.00) @db.Decimal(18, 2)
  delivery_time              DateTime?      @db.Timestamp(0)
  status                     Int?           @default(-1)
  staff_id                   Int?
  note                       String?        @db.VarChar(255)
  payment                    Int?
  address                    String?        @db.Text
  created_date               DateTime?      @db.Timestamp(0)
  modified_date              DateTime?      @db.Timestamp(0)
  created_by                 Int?
  modified_by                Int?
  users_bill_user_idTousers  users?         @relation("bill_user_idTousers", fields: [user_id], references: [id], onDelete: Restrict, onUpdate: Restrict, map: "fk_bill_user")
  users_bill_staff_idTousers users?         @relation("bill_staff_idTousers", fields: [staff_id], references: [id], onDelete: Restrict, onUpdate: Restrict, map: "fk_bill_user_staff")
  product_bill               product_bill[]

  @@unique([user_id, bill_date], map: "unique_bill")
  @@index([staff_id], map: "fk_bill_user_staff")
}

model address {
  id                       Int      @id @default(autoincrement())
  created_date             DateTime @default(now())
  modified_date            DateTime @updatedAt
  street_line_1            String   @db.VarChar(255)
  street_line_2            String?  @db.VarChar(255)
  city                     String   @db.VarChar(255)
  province                 String   @db.VarChar(255)
  postal_code              String   @db.VarChar(255)
  country                  String   @db.VarChar(255)
  default_shipping_address Boolean  @default(false)
  users                    users?   @relation(fields: [users_id], references: [id])
  users_id                 Int?
}

model category {
  id             Int        @id @default(autoincrement())
  category_name  String     @db.VarChar(255)
  category_code  String     @unique @db.VarChar(255)
  description    String?    @db.VarChar(255)
  parent_id      Int?
  active         Int        @default(1)
  created_date   DateTime?  @default(now())
  modified_date  DateTime?  @updatedAt
  created_by     Int?
  modified_by    Int?
  category       category?  @relation("categoryTocategory", fields: [parent_id], references: [id], onDelete: Restrict, onUpdate: Restrict, map: "fk_category_parent_id")
  other_category category[] @relation("categoryTocategory")
  product        product[]

  @@index([parent_id], map: "fk_category_parent_id")
}

model favorite {
  id           Int       @id @default(autoincrement())
  product_id   Int
  user_id      Int
  created_date DateTime? @db.Timestamp(0)
  product      product   @relation(fields: [product_id], references: [id], onUpdate: Restrict, map: "fk_favorite_product")
  users        users     @relation(fields: [user_id], references: [id], onUpdate: Restrict, map: "fk_favorite_user")

  @@index([product_id], map: "fk_favorite_product")
  @@index([user_id], map: "fk_favorite_user")
}

model asset {
  id                    Int                     @id @default(autoincrement())
  name                  String
  url                   String
  width                 Int
  height                Int
  format                String
  cloudinary_asset_id   String
  cloudinary_public_id  String
  created_date          DateTime?               @db.Timestamp(0)
  modified_date         DateTime?               @db.Timestamp(0)
  created_by            Int?
  modified_by           Int?
  product_asset         product_asset[]
  product_variant_asset product_variant_asset[]
  product               product[]
  product_variant       product_variant[]
}

model product {
  id                Int               @id @default(autoincrement())
  name              String            @db.VarChar(255)
  description       String?
  slug              String            @unique @db.VarChar(255)
  category_id       Int?
  brand_id          Int?
  active            Int               @default(1)
  created_date      DateTime?         @default(now())
  modified_date     DateTime?         @updatedAt
  created_by        Int?
  modified_by       Int?
  favorite          favorite[]
  category          category?         @relation(fields: [category_id], references: [id], onUpdate: Restrict, map: "fk_product_cate")
  product_bill      product_bill[]
  product_receipt   product_receipt[]
  product_variants  product_variant[]
  asset_ids         product_asset[]
  featured_asset    asset?            @relation(fields: [featured_asset_id], references: [id])
  featured_asset_id Int?

  @@index([category_id], map: "fk_product_cate")
}

model product_asset {
  id         Int     @id @default(autoincrement())
  product    product @relation(fields: [product_id], references: [id])
  product_id Int
  asset      asset   @relation(fields: [asset_id], references: [id])
  asset_id   Int

  @@unique([asset_id, product_id])
}

model product_variant_asset {
  id                 Int             @id @default(autoincrement())
  product_variant    product_variant @relation(fields: [product_variant_id], references: [id])
  product_variant_id Int
  asset              asset           @relation(fields: [asset_id], references: [id])
  asset_id           Int

  @@unique([asset_id, product_variant_id])
}

model product_variant {
  id                Int                      @id @default(autoincrement())
  stock             Int                      @default(0)
  sku               String                   @unique @db.VarChar(255)
  price             Int                      @default(0)
  created_date      DateTime?                @default(now())
  modified_date     DateTime?                @updatedAt
  created_by        Int?
  modified_by       Int?
  product_options   product_variant_option[]
  product           product?                 @relation(fields: [product_id], references: [id])
  product_id        Int?
  asset_ids         product_variant_asset[]
  featured_asset    asset?                   @relation(fields: [featured_asset_id], references: [id])
  featured_asset_id Int?
}

model product_variant_option {
  id                 Int             @id @default(autoincrement())
  product_variant    product_variant @relation(fields: [product_variant_id], references: [id])
  product_variant_id Int
  product_option     product_option  @relation(fields: [product_option_id], references: [id])
  product_option_id  Int

  @@unique([product_option_id, product_variant_id])
}

model product_bill {
  id            Int       @id @default(autoincrement())
  product_id    Int?
  bill_id       Int?
  price_sell    Decimal?  @db.Decimal(18, 2)
  quantity      Int
  total_price   Decimal?  @db.Decimal(18, 2)
  status        Int?      @default(0)
  created_date  DateTime? @db.Timestamp(0)
  modified_date DateTime? @db.Timestamp(0)
  created_by    Int?
  modified_by   Int?
  bill          bill?     @relation(fields: [bill_id], references: [id], onDelete: Restrict, onUpdate: Restrict, map: "fk_bill_product")
  product       product?  @relation(fields: [product_id], references: [id], onDelete: Restrict, onUpdate: Restrict, map: "fk_prodcut_bill")

  @@unique([product_id, bill_id], map: "unique_product_bill")
  @@index([bill_id], map: "fk_bill_product")
}

model product_receipt {
  id            Int       @id @default(autoincrement())
  product_id    Int?
  receipt_id    Int?
  price_entry   Decimal?  @db.Decimal(18, 2)
  quantity      Int
  total_price   Decimal?  @db.Decimal(18, 2)
  created_date  DateTime? @db.Timestamp(0)
  modified_date DateTime? @db.Timestamp(0)
  created_by    Int?
  modified_by   Int?
  product       product?  @relation(fields: [product_id], references: [id], onDelete: Restrict, onUpdate: Restrict, map: "fk_prodcut_receipt")
  receipt       receipt?  @relation(fields: [receipt_id], references: [id], onDelete: Restrict, onUpdate: Restrict, map: "fk_receipt_product")

  @@unique([product_id, receipt_id], map: "unique_product_receipt")
  @@index([receipt_id], map: "fk_receipt_product")
}

model rate {
  id            Int      @id @default(autoincrement())
  product_id    Int
  user_id       Int
  title         String   @db.VarChar(255)
  stars         Float    @default(0)
  cmt_datetime  DateTime @default(now())
  content       String
  created_date  DateTime @default(now())
  modified_date DateTime @updatedAt
  created_by    Int?
  modified_by   Int?

  users users @relation(fields: [user_id], references: [id], onUpdate: Restrict, map: "fk_users_cmt")

  @@unique([product_id, user_id, cmt_datetime], map: "unique_comments")
  @@index([user_id], map: "fk_users_cmt")
}

model receipt {
  id                               Int               @id @default(autoincrement())
  code                             String?           @db.VarChar(45)
  user_id                          Int
  receipt_date                     DateTime          @default(now()) @db.Timestamp(0)
  received_date                    DateTime?         @db.Timestamp(0)
  total_price                      Decimal?          @db.Decimal(18, 2)
  status                           Int?
  supplier_id                      Int?
  note                             String?           @db.VarChar(255)
  created_date                     DateTime?         @db.Timestamp(0)
  modified_date                    DateTime?         @db.Timestamp(0)
  created_by                       Int?
  modified_by                      Int?
  product_receipt                  product_receipt[]
  users_receipt_user_idTousers     users             @relation("receipt_user_idTousers", fields: [user_id], references: [id], onUpdate: Restrict, map: "fk_receipt_user")
  users_receipt_supplier_idTousers users?            @relation("receipt_supplier_idTousers", fields: [supplier_id], references: [id], onDelete: Restrict, onUpdate: Restrict, map: "fk_receipt_user_supplier_id")

  @@unique([user_id, receipt_date], map: "unique_receipt")
  @@index([supplier_id], map: "fk_receipt_user_supplier_id")
}

model role {
  id            Int          @id @default(autoincrement())
  role_name     String       @db.VarChar(255)
  role_code     String       @unique @db.VarChar(255)
  description   String?
  created_date  DateTime     @default(now())
  modified_date DateTime     @updatedAt
  created_by    Int?
  modified_by   Int?
  permissions   Json?
  users_role    users_role[]
}

model product_option {
  id               Int                      @id @default(autoincrement())
  name             OptionName
  value            String
  created_date     DateTime                 @default(now())
  modified_date    DateTime                 @updatedAt
  created_by       Int?
  modified_by      Int?
  product_variants product_variant_option[]
}

enum OptionName {
  Size     @map("size")
  Color    @map("color")
  Material @map("material")
  Style    @map("style")
}

model users {
  id                                 Int          @id @default(autoincrement())
  hashed_rt                          String?
  password                           String       @db.VarChar(255)
  first_name                         String?      @db.VarChar(255)
  last_name                          String?      @db.VarChar(255)
  gender                             Int          @default(0)
  date_of_birth                      DateTime?
  email                              String       @unique @db.VarChar(125)
  phone                              String?      @db.VarChar(10)
  active                             Int          @default(1)
  created_date                       DateTime     @default(now())
  modified_date                      DateTime     @updatedAt
  created_by                         Int?
  modified_by                        Int?
  bill_bill_user_idTousers           bill[]       @relation("bill_user_idTousers")
  bill_bill_staff_idTousers          bill[]       @relation("bill_staff_idTousers")
  favorite                           favorite[]
  rate                               rate[]
  receipt_receipt_user_idTousers     receipt[]    @relation("receipt_user_idTousers")
  receipt_receipt_supplier_idTousers receipt[]    @relation("receipt_supplier_idTousers")
  users_role                         users_role[]
  address                            address[]
}

model users_role {
  id      Int   @id @default(autoincrement())
  user_id Int
  role_id Int
  role    role  @relation(fields: [role_id], references: [id], onUpdate: Restrict, map: "fk_role_users")
  users   users @relation(fields: [user_id], references: [id], onUpdate: Restrict, map: "fk_users_role")

  @@unique([user_id, role_id], map: "unique_speciality")
  @@index([role_id], map: "fk_role_users")
}
